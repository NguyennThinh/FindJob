<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml"  lang="en">
<head>
    <title>Work CV</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/open-iconic-bootstrap.min.css">
  <link rel="stylesheet" href="/assets/css/animate.css">
  <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
  <link rel="stylesheet" href="/assets/css/magnific-popup.css">
  <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
  <link rel="stylesheet" href="/assets/css/aos.css">
  <link rel="stylesheet" href="/assets/css/ionicons.min.css">
  <link rel="stylesheet" href="/assets/css/bootstrap-datepicker.css">
  <link rel="stylesheet" href="/assets/css/jquery.timepicker.css">
  <link rel="stylesheet" href="/assets/css/css/bootstrap-reboot.css">
  <link rel="stylesheet" href="/assets/css/css/mixins/_text-hide.css">
  <link rel="stylesheet" href="/assets/css/flaticon.css">
  <link rel="stylesheet" href="/assets/css/icomoon.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap-grid.css">
  <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap-reboot.css">

  <!-- JS -->
  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/jquery-migrate-3.0.1.min.js"></script>
  <script src="/assets/js/popper.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/jquery.easing.1.3.js"></script>
  <script src="/assets/js/jquery.waypoints.min.js"></script>
  <script src="/assets/js/jquery.stellar.min.js"></script>
  <script src="/assets/js/owl.carousel.min.js"></script>
  <script src="/assets/js/jquery.magnific-popup.min.js"></script>
  <script src="/assets/js/aos.js"></script>
  <script src="/assets/js/jquery.animateNumber.min.js"></script>
  <script src="/assets/js/scrollax.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="/assets/js/google-map.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="https://cdn.ckeditor.com/ckeditor5/29.0.0/classic/ckeditor.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid px-md-4	">
    <a class="navbar-brand" href="/">Work CV</a>

    <div class="collapse navbar-collapse" id="ftco-nav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active"><a href="/" class="nav-link">Trang chủ</a></li>

        <li sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==1}" class="'nav-item"><a href="/job/list" class="nav-link">Công việc</a></li>

        <li sec:authorize="isAnonymous()"  class="'nav-item"><a href="/job/list" class="nav-link">Công việc</a></li>
        <li class="nav-item"><a href="/" class="nav-link">Tuyển dụng</a>
          <ul class="dropdown">


            <li sec:authorize="isAuthenticated()"><a th:href="@{'/profile/'+${session.user.idUser}}">Hồ Sơ</a></li>
            <li sec:authorize="isAnonymous()"><a href="/auth/login-page">Hồ Sơ</a></li>


            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==1}"><a href="/save-job/get-list" >Công việc đã lưu</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==2}" ><a th:href="@{/recruitment/list}" >Danh sách bài đăng</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${session.user.role.idRole ==1}" ><a href="/user/get-list-apply" >Công việc đã ứng tuyển</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${session.user.role.idRole ==1}"><a href="/user/get-list-company" >Công ty đã theo dõi</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==2}"><a href="/recruitment/post">Đăng tuyển</a></li>
            <li  sec:authorize="isAuthenticated()">
              <a onclick="document.getElementById('logout-form').submit()">Đăng xuất</a>
              <form id="logout-form" th:action="@{/auth/logout}" method="post">
              </form>
            </li>
          </ul>
        </li>
        <li sec:authorize="isAnonymous()"  class="nav-item cta cta-colored"><a href="/auth/login-page" class="nav-link">Đăng nhập</a></li>
        <li sec:authorize="isAuthenticated()"  class="nav-item cta cta-colored"><a th:href="@{'/profile/'+${session.user.idUser}}" class="nav-link">Wellcome, <span th:text="${session.user.getFullName()}"></span></a></li>
      </ul>
    </div>
  </div>
</nav>
<!-- END nav -->

<div class="hero-wrap img" style="background-image: url(user/assets/images/bg_1.jpg);">
  <div class="overlay"></div>
  <div class="container">
    <div class="row d-md-flex no-gutters slider-text align-items-center justify-content-center">
      <div class="col-md-10 d-flex align-items-center ">
        <div class="text text-center pt-5 mt-md-5">
          <p class="breadcrumbs mb-0"><span class="mr-3"><a href="/">Trang chủ <i class="ion-ios-arrow-forward"></i></a></span>Công việc <span></span></p>
          <h1 class="mb-3 bread">Danh sách công việc</h1>
          <div class="ftco-search my-md-5">
            <div class="row">
              <div class="col-md-12 nav-link-wrap">
                <div class="nav nav-pills text-center" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                  <a class="nav-link active mr-md-1" id="v-pills-1-tab" data-toggle="pill" href="#v-pills-1" role="tab" aria-controls="v-pills-1" aria-selected="true">Tìm công việc</a>

                  <a class="nav-link" id="v-pills-2-tab" data-toggle="pill" href="#v-pills-2" role="tab" aria-controls="v-pills-2" aria-selected="false">Tìm ứng cử viên</a>
                  <a class="nav-link" id="v-pills-3-tab" data-toggle="pill" href="#v-pills-3" role="tab" aria-controls="v-pills-3" aria-selected="false">Tìm theo địa điểm</a>

                </div>
              </div>
              <div class="col-md-12 tab-wrap">

                <div class="tab-content p-4" id="v-pills-tabContent">

                  <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel" aria-labelledby="v-pills-nextgen-tab">
                    <form action="/recruitment/search" method="post" class="search-job">
                      <div class="row no-gutters">

                        <div class="col-md-10 mr-md-2">
                          <div class="form-group">
                            <div class="form-field">
                              <div class="icon"><span class="icon-map-marker"></span></div>
                              <input type="text" name="keySearch" class="form-control" placeholder="Tìm kiếm công việc">
                            </div>
                          </div>
                        </div>
                        <div class="col-md">
                          <div class="form-group">
                            <div class="form-field">
                              <button type="submit" class="form-control btn btn-primary">Tìm kiếm</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>

                  <div class="tab-pane fade" id="v-pills-2" role="tabpanel" aria-labelledby="v-pills-performance-tab">
                    <form action="/user/search" method="post" class="search-job">
                      <div class="row no-gutters">

                        <div class="col-md-10 mr-md-2">
                          <div class="form-group">
                            <div class="form-field">
                              <div class="icon"><span class="icon-map-marker"></span></div>
                              <input type="text" name="keySearch" class="form-control" placeholder="Tìm kiếm ứng cử viên">
                            </div>
                          </div>
                        </div>
                        <div class="col-md">
                          <div class="form-group">
                            <div class="form-field">
                              <button type="submit" class="form-control btn btn-primary">Tìm kiếm</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="tab-pane fade" id="v-pills-3" role="tabpanel" aria-labelledby="v-pills-performance-tab">
                    <form action="/recruitment/searchaddress" method="post" class="search-job">
                      <div class="row no-gutters">

                        <div class="col-md-10 mr-md-2">
                          <div class="form-group">
                            <div class="form-field">
                              <div class="icon"><span class="icon-map-marker"></span></div>
                              <input type="text" name="keySearch" class="form-control" placeholder="Tìm kiếm theo địa điểm">
                            </div>
                          </div>
                        </div>
                        <div class="col-md">
                          <div class="form-group">
                            <div class="form-field">
                              <button type="submit" class="form-control btn btn-primary">Tìm kiếm</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="ftco-section bg-light">
  <div class="container">
    <div class="row">
      <div class="col-lg-9 pr-lg-5">
        <div class="row">
          <th:block th:each="recruitment : ${recruitments}">
            <div class="col-md-12 ">
              <div class="job-post-item p-4 d-block d-lg-flex align-items-center">
                <div class="one-third mb-4 mb-md-0">
                  <div class="job-post-item-header align-items-center">
                    <span class="subadge" th:text="${recruitment.type}"></span>
                    <h2 class="mr-3 text-black" ><a th:text="${recruitment.title}" th:href="${'/job/detail/'} +${recruitment.idRecruitment}"></a></h2>
                  </div>
                  <div class="job-post-item-body d-block d-md-flex">
                    <div class="mr-3"><span class="icon-layers"></span> <a href="#" th:text="${recruitment.company.companyName}" ></a></div>
                    <div><span class="icon-my_location"></span> <span th:text="${recruitment.address}"></span></div>
                  </div>
                </div>
                <input type="hidden" th:id="${'idRe'}+${recruitment.idRecruitment}" th:value="${recruitment.idRecruitment}">
                <div th:if="${session.user}" class="one-forth ml-auto d-flex align-items-center mt-4 md-md-0">
                  <div class="col-6" th:if="${!jobList.contains(recruitment)}">
                    <a class="btn btn-block btn-light btn-md"  th:href="@{'/save/job/'+${recruitment.idRecruitment}}" ><span class="icon-heart-o mr-2 text-danger"></span></a>
                  </div>
                  <div class="col-6" th:if="${jobList.contains(recruitment)}">
                    <a class="btn btn-block btn-light btn-md"   th:href="@{'/delete/job/'+${recruitment.idRecruitment}}"><span class="icon-heart mr-2 text-danger"></span></a>
                  </div>

                  <th:block th:if="${session.user.role.idRole == 1} ">
                    <a th:if=" ${ !listApply.contains(recruitment)}"
                       data-toggle="modal" th:data-target="${'#exampleModal'}+${recruitment.idRecruitment}" class="btn btn-primary py-2">Apply Job</a>

                    <a th:if=" ${ listApply.contains(recruitment)}"
                       class="btn-light py-2" style="padding-right: 10px; padding-left: 10px" >Applied</a>

                  </th:block>




                </div>
                <div th:unless="${session.user}" class="one-forth ml-auto d-flex align-items-center mt-4 md-md-0">
                  <div class="col-6" >
                    <a class="btn btn-block btn-light btn-md"  th:href="@{'/save/job/'+${recruitment.idRecruitment}}" ><span class="icon-heart-o mr-2 text-danger"></span></a>
                  </div>
                  <a  href="/auth/login-page" class="btn btn-primary py-2">Apply Job</a>
                </div>
              </div>
            </div><!-- end -->
            <!-- Modal -->
            <div class="modal fade" th:id="${'exampleModal'}+${recruitment.idRecruitment}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ứng tuyển: <span th:text="${recruitment.title}"></span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form method="post" action="/user/apply-job">
                    <div class="modal-body">
                      <div class="row">
                        <div class="col-12">
                          <select id="choose" onchange="choosed()" class="form-control" aria-label="Default select example">
                            <option selected>Chọn phương thức nộp</option>
                            <option value="1">Dùng cv đã cập nhật</option>
                            <option value="2">Nộp cv mới</option>
                          </select>
                        </div>
                        <div id="loai1" style="display:none" class="col-12">
                          <label for="fileUpload"
                                 class="col-form-label">Giới thiệu:</label>

                        </div>
                        <div id="loai2" style="display:none" class="col-12">

                          <label for="fileUpload"
                                 class="col-form-label">Chọn cv:</label>
                          <input type="file" class="form-control"
                                 id="fileUpload" name="file"   required>
                          <label for="fileUpload"
                                 class="col-form-label">Giới thiệu:</label>

                        </div>
                       <div class="col-12">
                          <textarea rows="10" cols="3" class="form-control"  name="text" id="text" >

                                                    </textarea>
                       </div>
                      </div>
                      <div class="modal-footer">
                        <input sec:authorize="isAuthenticated()" type="hidden" id="user_id" th:value="${session.user.idUser}">
                        <input type="hidden" id="recruitment_id" th:value="${recruitment.idRecruitment}">
                        <input  sec:authorize="isAuthenticated()" type="hidden" id="email" th:value="${session.user.email}">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                        <button type="button" id="button1" style="display: none" onclick="apply()" class="btn btn-primary">Nộp</button>
                        <button type="button" id="button2" style="display: none" onclick="apply()" class="btn btn-primary">Nộp</button>
                      </div>
                    </div>
                  </form>



                </div>
              </div>
            </div>


          </th:block>

        </div>
<!--        <div class="row mt-5">-->
<!--          <div class="col text-center">-->
<!--            <div class="block-27">-->
<!--              <ul>-->
<!--                <li th:if="${numberPage>0}"><a th:href="@{/recruitment/index(page = ${list.number - 1})}">&lt;</a></li>-->
<!--                <th:block th:each="recruitment,state  : ${recruitmentList}">-->
<!--                  <li th:class="${numberPage == state.index  ? 'active' : null }"><a th:href="@{/recruitment/index(page = ${state.index})}" th:text="${state.index + 1}"></a></li>-->
<!--                </th:block>-->
<!--                <li th:if="${numberPage<list.totalPages - 1}"><a th:href="@{/recruitment/index(page = ${list.number + 1})}">&gt;</a></li>-->
<!--              </ul>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->
      </div>
      <div class="col-lg-3 sidebar">
        <div class="row justify-content-center pb-3">
          <div class="col-md-12 heading-section ">
            <h2 class="mb-4">Công ty nổi bật</h2>
          </div>
        </div>
        <th:block th:each="company : ${companies}">
          <div class="sidebar-box">
            <div class="">
              <a th:href="${'/company/detail/'}+${company.idCompany}" class="company-wrap"><img  th:src="${company.logo}? @{${'/assets/images/'+company.logo}}:'https://www.consoft.vn/uploads/products/25709_lumenrt_connectedition_icon.png'"></a>
              <div class="text p-3">
                <h3><a th:href="${'/company/detail/'}+${company.idCompany}" th:text="${company.companyName}"></a></h3>
                <p><span class="number" style="color: black" th:text="${company.recruitments.size()}"></span> <span>Vị trí ứng tuyển</span></p>
              </div>
            </div>
          </div>
        </th:block>
      </div>
    </div>
  </div>
  <input type="hidden" id="hdnSession" data-value="@Request.RequestContext.HttpContext.Session['user']" />
</section>
<script>
  function apply(){
      var idUser = document.getElementById("user_id");
      var idRecruitment = document.getElementById("recruitment_id");
    var text = document.getElementById("text");
    var formData = new FormData();
    formData.append("user", idUser.value);
    formData.append("recruitment", idRecruitment.value)
    formData.append("text", text.value)
    console.log(idRecruitment.value)
    $.ajax(
            {
              type:'POST',
              url: '/user/apply-cv',
              contentType: false,
              processData: false,
              data: formData,
              success: (data)=>{
                swal({
                  title: 'Nộp cv thành công',
                  /* text: 'Redirecting...', */
                  icon: 'success',
                  timer: 3000,
                  buttons: true,
                  type: 'error'
                })
              },
              error:(err)=>{
                swal({
                  title: 'Nộp cv thất bại',
                  /* text: 'Redirecting...', */
                  icon: 'error',
                  timer: 3000,
                  buttons: true,
                  type: 'error'
                })
              }
            }
    )

  }



  function save(id){
    var name = "#idRe" +id;
    var idRe = $(name).val();
    var formData = new FormData();
    formData.append('idRe', idRe);
    $.ajax(
            {
              type: 'POST',
              url: '/save-job/save/',
              contentType: false,
              processData: false,
              data: formData,
              success: function (data) {
                if(data == "false"){
                  swal({
                    title: 'Bạn cần phải đăng nhập!',
                    /* text: 'Redirecting...', */
                    icon: 'error',
                    timer: 3000,
                    buttons: true,
                    type: 'error'
                  })
                }else if(data == "true"){
                  swal({
                    title: 'Lưu thành công!',
                    /* text: 'Redirecting...', */
                    icon: 'success',
                    timer: 3000,
                    buttons: true,
                    type: 'success'
                  })
                }else{
                  swal({
                    title: 'Bạn đã lưu bài này rồi!',
                    /* text: 'Redirecting...', */
                    icon: 'error',
                    timer: 3000,
                    buttons: true,
                    type: 'error'
                  })
                }
              },
              error: function (err) {
                alert(err);
              }
            }
    )
  }
</script>


<script>
    function choosed(){
      var name = document.getElementById('choose');

      var name1 = document.getElementById('loai1');
      var name2 = document.getElementById('loai2');
      var button1 = document.getElementById('button1');
      var button2 = document.getElementById('button2');
      var giaitri = name.value;
      if(giaitri == 1){
        name1.style.display= 'block';
        name2.style.display = 'none';
        button1.style.display = 'block';
        button2.style.display = 'none';
      }else{
        name2.style.display = 'block';
        name1.style.display = 'none';
        button2.style.display = 'block';
        button1.style.display = 'none';
      }
    }

</script>
<script>
  function  showNameCV(fileInput){
    file = fileInput.files[0];

    reader = new FileReader();

    reader.onload = function (e){
      $('#cvName').attr('src', file.name)
    }
    reader.readAsDataURL(file)
  }


  function  uploadPdf(fileInput){
    file = fileInput.files[0];
    var formData = new FormData();

    formData.append("file", file);
    formData.append("email", $("#email").val());

    $.ajax({
      type:'POST',
      url: '/profile/upload-cv',
      data:formData,
      cache:false,
      contentType: false,
      processData: false,
      success:function(data){
        console.log("success");
        console.log(data);
        swal({
          title: 'Cập nhật CV thành công!',
          /* text: 'Redirecting...', */
          icon: 'success',
          timer: 3000,
          buttons: true,
          type: 'success'
        })
      },
      error: function(data){
        console.log("error");
        console.log(data);
        swal({
          title: 'Cập nhật CV thất bại !',
          /* text: 'Redirecting...', */
          icon: 'error',
          timer: 3000,
          buttons: true,
          type: 'success'
        })
      }
    });

  }

  $(document).ready(function (){
    $('#fileUpload').change(function (){
      showNameCV(this);
      uploadPdf(this);




    });
  })


</script>


<!-- loader -->
<!--<div th:replace="public/fragments :: loading" id="ftco-loader" class="show fullscreen"></div>-->

</body>
</html>