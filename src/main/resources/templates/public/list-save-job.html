<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" >
<head>
<title>Work CV</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&display=swap" rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="/assets/css/open-iconic-bootstrap.min.css">
<link rel="stylesheet" href="/assets/css/animate.css">
<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
<link rel="stylesheet" href="/assets/css/magnific-popup.css">
<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
<link rel="stylesheet" href="/assets/css/aos.css">
<link rel="stylesheet" href="/assets/css/ionicons.min.css">
<link rel="stylesheet" href="/assets/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/assets/css/jquery.timepicker.css">
<link rel="stylesheet" href="/assets/css/css/bootstrap-reboot.css">
<link rel="stylesheet" href="/assets/css/css/mixins/_text-hide.css">
<link rel="stylesheet" href="/assets/css/flaticon.css">
<link rel="stylesheet" href="/assets/css/icomoon.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/bootstrap/bootstrap-grid.css">
<link rel="stylesheet" href="/assets/css/bootstrap/bootstrap-reboot.css">

<!-- JS -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery-migrate-3.0.1.min.js"></script>
<script src="/assets/js/popper.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/jquery.easing.1.3.js"></script>
<script src="/assets/js/jquery.waypoints.min.js"></script>
<script src="/assets/js/jquery.stellar.min.js"></script>
<script src="/assets/js/owl.carousel.min.js"></script>
<script src="/assets/js/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/aos.js"></script>
<script src="/assets/js/jquery.animateNumber.min.js"></script>
<script src="/assets/js/scrollax.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="/assets/js/google-map.js"></script>
<script src="/assets/js/main.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/29.0.0/classic/ckeditor.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid px-md-4	">
    <a class="navbar-brand" href="/">Work CV</a>

    <div class="collapse navbar-collapse" id="ftco-nav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active"><a href="/" class="nav-link">Trang chủ</a></li>

        <li sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==1}" class="'nav-item"><a href="/job/list" class="nav-link">Công việc</a></li>

        <li sec:authorize="isAnonymous()"  class="'nav-item"><a href="/job/list" class="nav-link">Công việc</a></li>
        <li class="nav-item"><a href="/" class="nav-link">Tuyển dụng</a>
          <ul class="dropdown">


            <li sec:authorize="isAuthenticated()"><a th:href="@{'/profile/'+${session.user.idUser}}">Hồ Sơ</a></li>
            <li sec:authorize="isAnonymous()"><a href="/auth/login-page">Hồ Sơ</a></li>


            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==1}"><a href="/save-job/list" >Công việc đã lưu</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==2}" ><a th:href="@{/recruitment/list}" >Danh sách bài đăng</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${session.user.role.idRole ==1}" ><a href="/user/get-list-apply" >Công việc đã ứng tuyển</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${session.user.role.idRole ==1}"><a href="/user/get-list-company" >Công ty đã theo dõi</a></li>
            <li  sec:authorize="isAuthenticated()" th:if="${ session.user.role.idRole ==2}"><a href="/recruitment/post">Đăng tuyển</a></li>
            <li  sec:authorize="isAuthenticated()">
              <a onclick="document.getElementById('logout-form').submit()">Đăng xuất</a>
              <form id="logout-form" th:action="@{/auth/logout}" method="post">
              </form>
            </li>
          </ul>
        </li>
        <li sec:authorize="isAnonymous()"  class="nav-item cta cta-colored"><a href="/auth/login-page" class="nav-link">Đăng nhập</a></li>
        <li sec:authorize="isAuthenticated()"  class="nav-item cta cta-colored"><a th:href="@{'/profile/'+${session.user.idUser}}" class="nav-link">Wellcome, <span th:text="${session.user.getFullName()}"></span></a></li>
      </ul>
    </div>
  </div>
</nav>
<!-- END nav -->
<div th:if="${delete}" class="toast" data-delay="2000" style="position:fixed;top: 100PX; right: 10PX;z-index: 2000;width: 300px">
  <script>
    swal({
      title: 'Xóa thành công!',
      /* text: 'Redirecting...', */
      icon: 'success',
      timer: 3000,
      buttons: true,
      type: 'success'
    })
  </script>
</div>
<!-- END nav -->
<div class="hero-wrap hero-wrap-2" style="background-image: url('user/assets/images/bg_1.jpg');" data-stellar-background-ratio="0.5" th:if="${session.user.role.idRole == 1 }">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text align-items-end justify-content-start">
      <div class="col-md-12 text-center mb-5">
        <p class="breadcrumbs mb-0"><span class="mr-3"><a href="/">Trang chủ <i class="ion-ios-arrow-forward"></i></a></span>Công việc <span></span></p>
        <h1 class="mb-3 bread">Danh sách công việc đã lưu</h1>
      </div>
    </div>
  </div>
</div>


<section class="ftco-section bg-light">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 pr-lg-5">
        <div th:if="${saveJobList.size() > 0}" class="row">
          <th:block th:each="saveJob : ${saveJobList}">
            <div class="col-md-12 ">
              <div class="job-post-item p-4 d-block d-lg-flex align-items-center">
                <div class="one-third mb-4 mb-md-0">
                  <div class="job-post-item-header align-items-center">
                    <span class="subadge" th:text="${saveJob.recruitment.type}"></span>
                    <h2 class="mr-3 text-black" ><a th:text="${saveJob.recruitment.title}" th:href="${'/job/detail/'} +${saveJob.recruitment.idRecruitment}"></a></h2>
                  </div>
                  <div class="job-post-item-body d-block d-md-flex">
                    <div class="mr-3"><span class="icon-layers"></span> <a href="#" th:text="${saveJob.recruitment.company.companyName}" ></a></div>
                    <div><span class="icon-my_location"></span> <span th:text="${saveJob.recruitment.address}"></span></div>
                  </div>
                </div>
                <input type="hidden" th:id="${'idRe'}+${saveJob.recruitment.idRecruitment}" th:value="${saveJob.recruitment.idRecruitment}">
                <div class="one-forth ml-auto d-flex align-items-center mt-4 md-md-0">
                  <div>
                    <a  th:href="${'/save-job/delete/'}+${saveJob.id}" class="icon text-center d-flex justify-content-center align-items-center icon mr-2">
                      <span class="icon-delete"></span>
                    </a>
                  </div>
                  <a th:if="${!jobList.contains(saveJob.recruitment)}" data-toggle="modal" th:data-target="${'#exampleModal'}+${saveJob.recruitment.idRecruitment}" class="btn btn-primary py-2">Apply Job</a>

                  <a th:if="${jobList.contains(saveJob.recruitment)}" data-toggle="modal" th:data-target="${'#exampleModal'}+${saveJob.recruitment.idRecruitment}" class="btn btn-primary py-2 disabled">Applied</a>
                </div>
              </div>
            </div><!-- end -->
            <!-- Modal -->
            <div class="modal fade" th:id="${'exampleModal'}+${saveJob.recruitment.idRecruitment}" tabindex="-1" role="dialog"
                 aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ứng tuyển: <span th:text="${saveJob.recruitment.title}"></span>
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form method="post" action="/user/apply-job">
                    <div class="modal-body">
                      <div class="row">
                        <div class="col-12">
                          <select id="choose" onchange="choosed()" class="form-control"
                                  aria-label="Default select example">
                            <option selected>Chọn phương thức nộp</option>
                            <option value="1">Dùng cv đã cập nhật</option>
                            <option value="2">Nộp cv mới</option>
                          </select>
                        </div>
                        <div id="loai1" style="display:none" class="col-12">
                          <label for="fileUpload"
                                 class="col-form-label">Giới thiệu:</label>

                        </div>
                        <div id="loai2" style="display:none" class="col-12">

                          <label for="fileUpload"
                                 class="col-form-label">Chọn cv:</label>
                          <input type="file" class="form-control"
                                 id="fileUpload" name="file" required>
                          <label for="fileUpload"
                                 class="col-form-label">Giới thiệu:</label>

                        </div>
                        <div class="col-12">
                          <textarea rows="10" cols="3" class="form-control" name="text" id="text">

                                                    </textarea>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <input sec:authorize="isAuthenticated()" type="hidden" id="user_id"
                               th:value="${session.user.idUser}">
                        <input type="hidden" id="recruitment_id" th:value="${saveJob.recruitment.idRecruitment}">
                        <input sec:authorize="isAuthenticated()" type="hidden" id="email"
                               th:value="${session.user.email}">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                        <button type="button" id="button1" style="display: none" onclick="apply()"
                                class="btn btn-primary">Nộp
                        </button>
                        <button type="button" id="button2" style="display: none" onclick="apply()"
                                class="btn btn-primary">Nộp
                        </button>
                      </div>
                    </div>
                  </form>


                </div>
              </div>
            </div>
          </th:block>

        </div>
        <div style="text-align: center" th:if="${saveJobList.size() < 1}">
          <p style="color:red;">Danh sách trống</p>
        </div>

      </div>

    </div>
  </div>
</section>

<script>
  function apply() {

    var idUser = document.getElementById("user_id");

    if (idUser != null) {
      var idRecruitment = document.getElementById("recruitment_id");
      var text = document.getElementById("text");
      var formData = new FormData();
      formData.append("user", idUser.value);
      formData.append("recruitment", idRecruitment.value)
      formData.append("text", text.value)
      console.log(idRecruitment.value)
      $.ajax(
              {
                type: 'POST',
                url: '/user/apply-cv',
                contentType: false,
                processData: false,
                data: formData,
                success: (data) => {
                  swal({
                    title: 'Nộp cv thành công',
                    /* text: 'Redirecting...', */
                    icon: 'success',
                    timer: 3000,
                    buttons: true,
                    type: 'error'
                  })
                },
                error: (err) => {
                  swal({
                    title: 'Nộp cv thất bại',
                    /* text: 'Redirecting...', */
                    icon: 'error',
                    timer: 3000,
                    buttons: true,
                    type: 'error'
                  })
                }
              }
      )
    } else {
      swal({
        title: 'Bạn chưa đăng nhập',
        /* text: 'Redirecting...', */
        icon: 'error',
        timer: 3000,
        buttons: true,
        type: 'error'
      })
    }


  }

  function choosed() {
    var name = document.getElementById('choose');

    var name1 = document.getElementById('loai1');
    var name2 = document.getElementById('loai2');
    var button1 = document.getElementById('button1');
    var button2 = document.getElementById('button2');
    var giaitri = name.value;
    if (giaitri == 1) {
      name1.style.display = 'block';
      name2.style.display = 'none';
      button1.style.display = 'block';
      button2.style.display = 'none';
    } else {
      name2.style.display = 'block';
      name1.style.display = 'none';
      button2.style.display = 'block';
      button1.style.display = 'none';
    }
  }

  function showNameCV(fileInput) {
    file = fileInput.files[0];

    reader = new FileReader();

    reader.onload = function (e) {
      $('#cvName').attr('src', file.name)
    }
    reader.readAsDataURL(file)
  }


  function uploadPdf(fileInput) {
    file = fileInput.files[0];
    var formData = new FormData();

    formData.append("file", file);
    formData.append("email", $("#email").val());

    $.ajax({
      type: 'POST',
      url: '/profile/upload-cv',
      data: formData,
      cache: false,
      contentType: false,
      processData: false,
      success: function (data) {
        console.log("success");
        console.log(data);
        swal({
          title: 'Cập nhật CV thành công!',
          /* text: 'Redirecting...', */
          icon: 'success',
          timer: 3000,
          buttons: true,
          type: 'success'
        })
      },
      error: function (data) {
        console.log("error");
        console.log(data);
        swal({
          title: 'Cập nhật CV thất bại !',
          /* text: 'Redirecting...', */
          icon: 'error',
          timer: 3000,
          buttons: true,
          type: 'success'
        })
      }
    });

  }

  $(document).ready(function () {
    $('#fileUpload').change(function () {
      showNameCV(this);
      uploadPdf(this);


    });
  })

</script>


</body>
</html>